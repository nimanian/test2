<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Voice Recording</title>
    <script src="https://cdn.jsdelivr.net/npm/aws-amplify@4.3.0"></script>
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>Test Voice Recording</h1>
    </header>

    <!-- Voice Recording Section -->
    <section id="voice-recording">
        <h2>Voice Recording</h2>
        <button id="voiceBtn">Start Recording</button>
        <p id="status"></p> <!-- Status message -->
        <audio id="audioPlayback" controls></audio> <!-- For playback -->
    </section>

    <script>
        const voiceButton = document.getElementById('voiceBtn');
        const statusText = document.getElementById('status');
        const audioPlayback = document.getElementById('audioPlayback');
        let mediaRecorder;
        let audioChunks = [];

        // When the button is clicked, start or stop the recording
        voiceButton.addEventListener('click', async () => {
            try {
                if (mediaRecorder && mediaRecorder.state === "recording") {
                    mediaRecorder.stop();
                    voiceButton.textContent = "Start Recording";
                    statusText.textContent = "Recording stopped.";
                } else {
                    audioChunks = [];
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);

                    // Collect audio data in chunks
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    // When recording stops, create a blob and enable playback
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        audioPlayback.src = audioUrl; // Play the recorded audio
                        statusText.textContent = "Recording stopped. Audio is ready to play.";
                    };

                    // Start recording
                    mediaRecorder.start();
                    voiceButton.textContent = "Stop Recording";
                    statusText.textContent = "Recording...";
                }
            } catch (error) {
                console.error("Error accessing microphone:", error);
                statusText.textContent = "Error accessing microphone. Please check permissions.";
            }
        });
    </script>
</body>
</html>
